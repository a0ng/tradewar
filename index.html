<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AA-DD Model Tariff Simulator</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
        color: #333;
      }

      h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 30px;
      }

      .container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }

      .controls {
        flex: 1;
        min-width: 300px;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .sliders {
        margin-bottom: 20px;
      }

      .slider-container {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      input[type="range"] {
        width: 100%;
        margin-bottom: 5px;
      }

      .slider-value {
        font-weight: bold;
        text-align: right;
      }

      button {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        display: block;
        width: 100%;
        margin-top: 10px;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #2980b9;
      }

      .indicators {
        flex: 1;
        min-width: 300px;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .indicator {
        margin-bottom: 15px;
      }

      .indicator h3 {
        margin: 0 0 10px 0;
        color: #2c3e50;
      }

      .indicator-value {
        font-size: 24px;
        font-weight: bold;
        color: #3498db;
      }

      .indicator-change {
        margin-left: 10px;
        font-size: 16px;
      }

      .increase {
        color: #27ae60;
      }

      .decrease {
        color: #e74c3c;
      }

      .trade-response {
        background-color: #f8f9fa;
        padding: 10px 15px;
        border-radius: 6px;
        margin: 15px 0;
        border-left: 4px solid #3498db;
      }

      .foreign-tariff {
        font-size: 16px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
      }

      #foreign-tariff-value {
        font-weight: bold;
        margin: 0 5px;
      }

      .foreign-status {
        width: 100%;
        margin-top: 5px;
        font-size: 14px;
        font-style: italic;
        color: #666;
      }

      .retaliation {
        color: #e74c3c;
      }

      .charts {
        flex: 100%;
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }

      .chart-container {
        flex: 1 0 45%;
        min-width: 300px;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        height: 300px;
      }

      .info-panel {
        flex: 100%;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
      }

      .history {
        margin-top: 20px;
        max-height: 200px;
        overflow-y: auto;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 4px;
      }

      .history-item {
        padding: 8px;
        border-bottom: 1px solid #eee;
      }

      .tabs {
        display: flex;
        margin-bottom: 15px;
        border-bottom: 1px solid #ddd;
      }

      .tab {
        padding: 10px 15px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
      }

      .tab.active {
        border-bottom: 2px solid #3498db;
        font-weight: bold;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <h1>AA-DD Model Tariff Simulator</h1>

    <div class="container">
      <div class="controls">
        <h2>Policy Controls</h2>
        <div class="sliders">
          <div class="slider-container">
            <label for="tariff-rate">Domestic Tariff Rate</label>
            <input
              type="range"
              id="tariff-rate"
              min="0"
              max="50"
              value="10"
              step="1"
            />
            <div class="slider-value">
              <span id="tariff-rate-value">10</span>%
            </div>
          </div>

          <div class="slider-container">
            <label for="world-demand">World Demand for Domestic Goods</label>
            <input
              type="range"
              id="world-demand"
              min="50"
              max="150"
              value="100"
              step="1"
            />
            <div class="slider-value">
              <span id="world-demand-value">100</span>%
            </div>
          </div>

          <div class="slider-container">
            <label for="domestic-demand">Domestic Demand</label>
            <input
              type="range"
              id="domestic-demand"
              min="50"
              max="150"
              value="100"
              step="1"
            />
            <div class="slider-value">
              <span id="domestic-demand-value">100</span>%
            </div>
          </div>
        </div>

        <div class="trade-response">
          <h3>Foreign Response</h3>
          <div class="foreign-tariff">
            <span>Foreign Tariff Rate: </span>
            <span id="foreign-tariff-value">10</span>%
            <div class="foreign-status" id="foreign-status">Initial state</div>
          </div>
        </div>

        <button id="apply-policy">Apply Policy Changes</button>
        <button id="reset-simulation">Reset Simulation</button>
      </div>

      <div class="indicators">
        <h2>Economic Indicators</h2>
        <div class="indicator">
          <h3>GDP</h3>
          <span class="indicator-value" id="gdp-value">100.0</span>
          <span class="indicator-change" id="gdp-change"></span>
        </div>

        <div class="indicator">
          <h3>Exchange Rate (Domestic/Foreign)</h3>
          <span class="indicator-value" id="exchange-rate-value">1.00</span>
          <span class="indicator-change" id="exchange-rate-change"></span>
        </div>

        <div class="indicator">
          <h3>Current Account Balance (% of GDP)</h3>
          <span class="indicator-value" id="current-account-value">0.0</span>%
          <span class="indicator-change" id="current-account-change"></span>
        </div>
      </div>

      <div class="charts">
        <div class="chart-container">
          <h3>GDP Trend</h3>
          <canvas id="gdp-chart"></canvas>
        </div>

        <div class="chart-container">
          <h3>Exchange Rate Trend</h3>
          <canvas id="exchange-rate-chart"></canvas>
        </div>

        <div class="chart-container">
          <h3>Current Account Trend</h3>
          <canvas id="current-account-chart"></canvas>
        </div>

        <div class="chart-container">
          <h3>AA-DD Model</h3>
          <canvas id="aadd-chart"></canvas>
        </div>
      </div>

      <div class="info-panel">
        <div class="tabs">
          <div class="tab active" data-tab="model-info">Model Information</div>
          <div class="tab" data-tab="policy-history">Policy History</div>
          <div class="tab" data-tab="help">Help</div>
        </div>

        <div class="tab-content active" id="model-info">
          <h3>AA-DD Model Overview with Foreign Response</h3>
          <p>
            The AA-DD model is a macroeconomic framework that helps understand
            how policies affect an open economy's GDP and exchange rate:
          </p>
          <p>
            <strong>AA curve:</strong> Represents asset market equilibrium. When
            tariffs increase, the exchange rate may appreciate (strengthen) due
            to increased demand for domestic currency.
          </p>
          <p>
            <strong>DD curve:</strong> Represents goods market equilibrium.
            Higher tariffs can increase GDP by shifting demand to domestic
            products.
          </p>
          <p>Key relationships in this simulator:</p>
          <ul>
            <li>
              <strong>Domestic Tariffs:</strong> Higher tariffs tend to increase
              GDP by substituting imports with domestic products, but may create
              trade imbalances
            </li>
            <li>
              <strong>Foreign Retaliation:</strong> When you increase tariffs,
              foreign countries will respond by setting their tariff rate to
              your rate + 1% after a one-turn delay
            </li>
            <li>
              <strong>Foreign Tariffs:</strong> Higher foreign tariffs reduce
              your exports, lowering GDP and worsening your current account
            </li>
            <li>
              <strong>Exchange Rate:</strong> A stronger currency makes exports
              more expensive and imports cheaper
            </li>
            <li>
              <strong>Current Account:</strong> The balance of trade (exports
              minus imports)
            </li>
          </ul>
          <p>
            <strong>Trade War Dynamics:</strong> Increasing your tariffs may
            boost GDP initially, but foreign retaliation will partially offset
            those gains and may lead to lower GDP and a worse current account in
            the long run.
          </p>
        </div>

        <div class="tab-content" id="policy-history">
          <h3>Policy Changes History</h3>
          <div class="history" id="history-log">
            <div class="history-item">
              Simulation started with default parameters
            </div>
          </div>
        </div>

        <div class="tab-content" id="help">
          <h3>How to Use This Simulator</h3>
          <p>
            1. Adjust the <strong>Tariff Rate</strong> slider to change import
            tariffs
          </p>
          <p>
            2. Modify <strong>World Demand</strong> to simulate changes in
            foreign appetite for domestic goods
          </p>
          <p>
            3. Adjust <strong>Domestic Demand</strong> to change internal
            consumption patterns
          </p>
          <p>
            4. Click <strong>Apply Policy Changes</strong> to see how your
            adjustments affect the economy
          </p>
          <p>
            5. Use <strong>Reset Simulation</strong> to start over with default
            values
          </p>
          <p>
            Watch how changes affect GDP, the exchange rate, and the current
            account balance over time.
          </p>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script>
      // TypeScript interface definitions (in comments for HTML compatibility)
      /*
        interface EconomicState {
            gdp: number;
            exchangeRate: number;
            currentAccount: number;
            tariffRate: number;
            worldDemand: number;
            domesticDemand: number;
            turn: number;
        }

        interface HistoryEntry {
            turn: number;
            action: string;
            gdp: number;
            exchangeRate: number;
            currentAccount: number;
        }
        */

      // Global state (would be typed in TypeScript)
      const state = {
        gdp: 100,
        exchangeRate: 1.0,
        currentAccount: 0,
        tariffRate: 10,
        foreignTariffRate: 10,
        worldDemand: 100,
        domesticDemand: 100,
        turn: 0,
        retaliationDelay: 0,
        retaliated: false,
      };

      const history = [];
      const maxHistoryLength = 20;

      // Charts
      let gdpChart, exchangeRateChart, currentAccountChart, aaddChart;

      // DOM elements
      const tariffRateSlider = document.getElementById("tariff-rate");
      const tariffRateValue = document.getElementById("tariff-rate-value");
      const worldDemandSlider = document.getElementById("world-demand");
      const worldDemandValue = document.getElementById("world-demand-value");
      const domesticDemandSlider = document.getElementById("domestic-demand");
      const domesticDemandValue = document.getElementById(
        "domestic-demand-value"
      );

      const gdpValueElement = document.getElementById("gdp-value");
      const gdpChangeElement = document.getElementById("gdp-change");
      const exchangeRateValueElement = document.getElementById(
        "exchange-rate-value"
      );
      const exchangeRateChangeElement = document.getElementById(
        "exchange-rate-change"
      );
      const currentAccountValueElement = document.getElementById(
        "current-account-value"
      );
      const currentAccountChangeElement = document.getElementById(
        "current-account-change"
      );
      const foreignTariffValueElement = document.getElementById(
        "foreign-tariff-value"
      );
      const foreignStatusElement = document.getElementById("foreign-status");

      const applyPolicyButton = document.getElementById("apply-policy");
      const resetSimulationButton = document.getElementById("reset-simulation");
      const historyLogElement = document.getElementById("history-log");

      // Tab functionality
      const tabs = document.querySelectorAll(".tab");
      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          // Remove active class from all tabs
          tabs.forEach((t) => t.classList.remove("active"));

          // Add active class to clicked tab
          tab.classList.add("active");

          // Hide all tab content
          const tabContents = document.querySelectorAll(".tab-content");
          tabContents.forEach((content) => content.classList.remove("active"));

          // Show the corresponding tab content
          const tabId = tab.getAttribute("data-tab");
          document.getElementById(tabId).classList.add("active");
        });
      });

      // Initialize sliders
      tariffRateSlider.addEventListener("input", () => {
        tariffRateValue.textContent = tariffRateSlider.value;
      });

      worldDemandSlider.addEventListener("input", () => {
        worldDemandValue.textContent = worldDemandSlider.value;
      });

      domesticDemandSlider.addEventListener("input", () => {
        domesticDemandValue.textContent = domesticDemandSlider.value;
      });

      // Apply policy changes
      applyPolicyButton.addEventListener("click", () => {
        const prevState = { ...state };
        const prevTariffRate = state.tariffRate;

        // Update state with new policy settings
        state.tariffRate = parseInt(tariffRateSlider.value);
        state.worldDemand = parseInt(worldDemandSlider.value);
        state.domesticDemand = parseInt(domesticDemandSlider.value);
        state.turn++;

        // Check for foreign retaliation based on tariff changes
        handleForeignRetaliation(prevTariffRate);

        // Calculate new economic indicators based on the AA-DD model
        calculateNewEconomicState();

        // Update UI
        updateIndicators(prevState);
        updateForeignTariffUI();
        updateCharts();
        addHistoryEntry(
          `Turn ${state.turn}: Domestic Tariff ${state.tariffRate}%, Foreign Tariff ${state.foreignTariffRate}%, World Demand ${state.worldDemand}%, Domestic Demand ${state.domesticDemand}%`
        );
      });

      // Handle foreign retaliation to tariff changes
      function handleForeignRetaliation(prevTariffRate) {
        // Reset retaliation flag
        state.retaliated = false;

        // If domestic tariffs increased, foreign countries will respond
        if (state.tariffRate > prevTariffRate) {
          // Foreign countries prepare to retaliate
          state.retaliationDelay = 1; // Will retaliate after 1 turn
          foreignStatusElement.textContent =
            "Foreign countries are considering retaliation";
          foreignStatusElement.className = "foreign-status";
        }
        // If domestic tariffs decreased
        else if (state.tariffRate < prevTariffRate) {
          // Foreign countries may reduce their tariffs as well, but with a delay
          state.retaliationDelay = 1;
          foreignStatusElement.textContent =
            "Foreign countries are considering tariff reduction";
          foreignStatusElement.className = "foreign-status";
        }
        // If retaliationDelay is active and it's time to act
        else if (state.retaliationDelay > 0) {
          state.retaliationDelay--;

          if (state.retaliationDelay === 0) {
            // Time to retaliate - set foreign tariff to domestic + 1%
            state.foreignTariffRate = Math.min(50, state.tariffRate + 1);
            state.retaliated = true;

            if (state.foreignTariffRate > prevTariffRate) {
              foreignStatusElement.textContent =
                "Foreign countries have retaliated with higher tariffs!";
              foreignStatusElement.className = "foreign-status retaliation";
            } else {
              foreignStatusElement.textContent =
                "Foreign countries have adjusted their tariffs";
              foreignStatusElement.className = "foreign-status";
            }
          }
        }
      }

      // Update the foreign tariff UI
      function updateForeignTariffUI() {
        foreignTariffValueElement.textContent =
          state.foreignTariffRate.toString();
      }

      // Reset simulation
      resetSimulationButton.addEventListener("click", () => {
        // Reset to initial values
        state.gdp = 100;
        state.exchangeRate = 1.0;
        state.currentAccount = 0;
        state.tariffRate = 10;
        state.foreignTariffRate = 10;
        state.worldDemand = 100;
        state.domesticDemand = 100;
        state.turn = 0;
        state.retaliationDelay = 0;
        state.retaliated = false;

        // Reset sliders
        tariffRateSlider.value = "10";
        tariffRateValue.textContent = "10";
        worldDemandSlider.value = "100";
        worldDemandValue.textContent = "100";
        domesticDemandSlider.value = "100";
        domesticDemandValue.textContent = "100";

        // Reset foreign tariff display
        foreignTariffValueElement.textContent = "10";
        foreignStatusElement.textContent = "Initial state";
        foreignStatusElement.className = "foreign-status";

        // Update UI
        updateIndicators({});
        resetCharts();

        // Clear history except initial entry
        while (historyLogElement.childNodes.length > 1) {
          historyLogElement.removeChild(historyLogElement.lastChild);
        }

        history.length = 0;
      });

      // Calculate new economic state based on AA-DD model
      function calculateNewEconomicState() {
        // Simplified AA-DD model calculations

        // Effect of domestic tariff rate on GDP (DD curve)
        // Higher tariffs boost GDP by substituting imports with domestic production
        const tariffEffect = (state.tariffRate - 10) * 0.15;

        // Effect of foreign tariffs on GDP (reduces exports)
        // Higher foreign tariffs hurt GDP by reducing exports
        const foreignTariffEffect = (state.foreignTariffRate - 10) * -0.12;

        // Effect of world demand (DD curve)
        // Higher world demand increases exports and GDP
        const worldDemandEffect = (state.worldDemand - 100) * 0.1;

        // Effect of domestic demand (DD curve)
        // Higher domestic demand increases GDP
        const domesticDemandEffect = (state.domesticDemand - 100) * 0.12;

        // Calculate GDP change, including foreign tariff effects
        const gdpChange =
          tariffEffect +
          foreignTariffEffect +
          worldDemandEffect +
          domesticDemandEffect;
        state.gdp = Math.max(50, Math.min(150, state.gdp + gdpChange));

        // Effect of tariff rate on exchange rate (AA curve)
        // Higher domestic tariffs may appreciate the currency (but with some complexity)
        const tariffExchangeEffect = (state.tariffRate - 10) * 0.005;

        // Effect of foreign tariff rate on exchange rate (AA curve)
        // Higher foreign tariffs may depreciate the domestic currency
        const foreignTariffExchangeEffect =
          (state.foreignTariffRate - 10) * -0.003;

        // Current account affects exchange rate (AA curve)
        // A positive current account tends to appreciate the currency
        const caExchangeEffect = state.currentAccount * 0.01;

        // Calculate exchange rate change, including foreign tariff effects
        const exchangeRateChange =
          tariffExchangeEffect + foreignTariffExchangeEffect + caExchangeEffect;
        state.exchangeRate = Math.max(
          0.5,
          Math.min(1.5, state.exchangeRate + exchangeRateChange)
        );

        // Calculate current account based on tariffs, exchange rate, and demand
        // Higher domestic tariffs reduce imports, improving current account
        // Higher foreign tariffs reduce exports, worsening current account
        // Stronger currency reduces exports, worsening current account
        // Higher world demand improves current account
        const tariffCAEffect = (state.tariffRate - 10) * 0.1;
        const foreignTariffCAEffect = (state.foreignTariffRate - 10) * -0.15;
        const exchangeRateCAEffect = (1 - state.exchangeRate) * 8;
        const worldDemandCAEffect = (state.worldDemand - 100) * 0.08;
        const domesticDemandCAEffect = (100 - state.domesticDemand) * 0.05;

        // Calculate current account balance with foreign tariff effects
        state.currentAccount = Math.max(
          -15,
          Math.min(
            15,
            tariffCAEffect +
              foreignTariffCAEffect +
              exchangeRateCAEffect +
              worldDemandCAEffect +
              domesticDemandCAEffect
          )
        );

        // If retaliation just happened this turn, add an immediate extra impact
        // Representing market shock/adjustment costs from sudden policy changes
        if (state.retaliated) {
          // Retaliation creates market uncertainty temporarily reducing GDP
          state.gdp -= 1.5;
          // And can cause exchange rate volatility
          state.exchangeRate -= 0.02;
          // And immediately worsens current account due to trade disruption
          state.currentAccount -= 0.8;
        }
      }

      // Update economic indicators in the UI
      function updateIndicators(prevState) {
        // Update GDP
        gdpValueElement.textContent = state.gdp.toFixed(1);
        if (prevState.gdp) {
          const gdpChange = state.gdp - prevState.gdp;
          gdpChangeElement.textContent = formatChange(gdpChange);
          gdpChangeElement.className =
            "indicator-change " + (gdpChange >= 0 ? "increase" : "decrease");
        }

        // Update exchange rate
        exchangeRateValueElement.textContent = state.exchangeRate.toFixed(2);
        if (prevState.exchangeRate) {
          const exchangeRateChange =
            state.exchangeRate - prevState.exchangeRate;
          exchangeRateChangeElement.textContent =
            formatChange(exchangeRateChange);
          exchangeRateChangeElement.className =
            "indicator-change " +
            (exchangeRateChange >= 0 ? "increase" : "decrease");
        }

        // Update current account
        currentAccountValueElement.textContent =
          state.currentAccount.toFixed(1);
        if (prevState.currentAccount !== undefined) {
          const currentAccountChange =
            state.currentAccount - prevState.currentAccount;
          currentAccountChangeElement.textContent =
            formatChange(currentAccountChange);
          currentAccountChangeElement.className =
            "indicator-change " +
            (currentAccountChange >= 0 ? "increase" : "decrease");
        }
      }

      // Format change value for display
      function formatChange(value) {
        return (value >= 0 ? "+" : "") + value.toFixed(1);
      }

      // Add entry to history log
      function addHistoryEntry(text) {
        const historyItem = document.createElement("div");
        historyItem.className = "history-item";
        historyItem.textContent = text;

        historyLogElement.appendChild(historyItem);

        // Add to history array
        history.push({
          turn: state.turn,
          action: text,
          gdp: state.gdp,
          exchangeRate: state.exchangeRate,
          currentAccount: state.currentAccount,
        });

        // Trim history if too long
        if (history.length > maxHistoryLength) {
          history.shift();
        }

        // Auto-scroll to bottom
        historyLogElement.scrollTop = historyLogElement.scrollHeight;
      }

      // Initialize charts
      function initializeCharts() {
        // Configure Chart.js global settings
        Chart.defaults.font.family =
          "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
        Chart.defaults.color = "#666";

        // GDP Chart
        gdpChart = new Chart(document.getElementById("gdp-chart"), {
          type: "line",
          data: {
            labels: ["Start"],
            datasets: [
              {
                label: "GDP",
                data: [state.gdp],
                borderColor: "#3498db",
                backgroundColor: "rgba(52, 152, 219, 0.1)",
                tension: 0.4,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                min: 50,
                max: 150,
                title: {
                  display: true,
                  text: "GDP Index",
                },
              },
            },
          },
        });

        // Exchange Rate Chart
        exchangeRateChart = new Chart(
          document.getElementById("exchange-rate-chart"),
          {
            type: "line",
            data: {
              labels: ["Start"],
              datasets: [
                {
                  label: "Exchange Rate",
                  data: [state.exchangeRate],
                  borderColor: "#e74c3c",
                  backgroundColor: "rgba(231, 76, 60, 0.1)",
                  tension: 0.4,
                  fill: true,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  min: 0.5,
                  max: 1.5,
                  title: {
                    display: true,
                    text: "Exchange Rate",
                  },
                },
              },
            },
          }
        );

        // Current Account Chart
        currentAccountChart = new Chart(
          document.getElementById("current-account-chart"),
          {
            type: "line",
            data: {
              labels: ["Start"],
              datasets: [
                {
                  label: "Current Account",
                  data: [state.currentAccount],
                  borderColor: "#2ecc71",
                  backgroundColor: "rgba(46, 204, 113, 0.1)",
                  tension: 0.4,
                  fill: true,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  min: -15,
                  max: 15,
                  title: {
                    display: true,
                    text: "% of GDP",
                  },
                },
              },
            },
          }
        );

        // AA-DD Model Chart
        aaddChart = new Chart(document.getElementById("aadd-chart"), {
          type: "scatter",
          data: {
            datasets: [
              {
                label: "AA Curve",
                data: generateAACurve(),
                showLine: true,
                borderColor: "#9b59b6",
                backgroundColor: "rgba(0,0,0,0)",
                pointRadius: 0,
              },
              {
                label: "DD Curve",
                data: generateDDCurve(),
                showLine: true,
                borderColor: "#f39c12",
                backgroundColor: "rgba(0,0,0,0)",
                pointRadius: 0,
              },
              {
                label: "Current Position",
                data: [{ x: state.gdp, y: state.exchangeRate }],
                pointBackgroundColor: "#e74c3c",
                pointBorderColor: "#c0392b",
                pointRadius: 8,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                min: 60,
                max: 140,
                title: {
                  display: true,
                  text: "GDP",
                },
              },
              y: {
                min: 0.6,
                max: 1.4,
                title: {
                  display: true,
                  text: "Exchange Rate",
                },
              },
            },
          },
        });
      }

      // Generate points for AA curve
      function generateAACurve() {
        const points = [];
        for (let gdp = 60; gdp <= 140; gdp += 5) {
          // AA curve equation: Exchange rate = f(GDP, domestic tariff, foreign tariff)
          // Higher GDP tends to increase exchange rate in AA curve
          // Higher domestic tariffs tend to appreciate the exchange rate
          // Higher foreign tariffs tend to depreciate the exchange rate
          const exchangeRate =
            1 +
            (gdp - 100) * 0.002 +
            (state.tariffRate - 10) * 0.005 +
            (state.foreignTariffRate - 10) * -0.003;
          points.push({ x: gdp, y: exchangeRate });
        }
        return points;
      }

      // Generate points for DD curve
      function generateDDCurve() {
        const points = [];
        for (
          let exchangeRate = 0.6;
          exchangeRate <= 1.4;
          exchangeRate += 0.05
        ) {
          // DD curve equation: GDP = f(Exchange rate, domestic tariff, foreign tariff)
          // Higher exchange rate reduces GDP in DD curve
          // Higher domestic tariffs increase GDP in DD curve
          // Higher foreign tariffs decrease GDP in DD curve
          const gdp =
            100 -
            (exchangeRate - 1) * 40 +
            (state.tariffRate - 10) * 0.15 +
            (state.foreignTariffRate - 10) * -0.12;
          points.push({ x: gdp, y: exchangeRate });
        }
        return points;
      }

      // Update charts with new data
      function updateCharts() {
        // Add new data point to GDP chart
        gdpChart.data.labels.push("Turn " + state.turn);
        gdpChart.data.datasets[0].data.push(state.gdp);

        // Add new data point to Exchange Rate chart
        exchangeRateChart.data.labels.push("Turn " + state.turn);
        exchangeRateChart.data.datasets[0].data.push(state.exchangeRate);

        // Add new data point to Current Account chart
        currentAccountChart.data.labels.push("Turn " + state.turn);
        currentAccountChart.data.datasets[0].data.push(state.currentAccount);

        // Update AA and DD curves
        aaddChart.data.datasets[0].data = generateAACurve();
        aaddChart.data.datasets[1].data = generateDDCurve();

        // Update current position
        aaddChart.data.datasets[2].data = [
          { x: state.gdp, y: state.exchangeRate },
        ];

        // Limit the number of visible data points for better readability
        const maxVisiblePoints = 10;
        if (gdpChart.data.labels.length > maxVisiblePoints) {
          gdpChart.data.labels = gdpChart.data.labels.slice(-maxVisiblePoints);
          gdpChart.data.datasets[0].data = gdpChart.data.datasets[0].data.slice(
            -maxVisiblePoints
          );
          exchangeRateChart.data.labels = exchangeRateChart.data.labels.slice(
            -maxVisiblePoints
          );
          exchangeRateChart.data.datasets[0].data =
            exchangeRateChart.data.datasets[0].data.slice(-maxVisiblePoints);
          currentAccountChart.data.labels =
            currentAccountChart.data.labels.slice(-maxVisiblePoints);
          currentAccountChart.data.datasets[0].data =
            currentAccountChart.data.datasets[0].data.slice(-maxVisiblePoints);
        }

        // Update charts
        gdpChart.update();
        exchangeRateChart.update();
        currentAccountChart.update();
        aaddChart.update();
      }

      // Reset charts to initial state
      function resetCharts() {
        // Reset GDP chart
        gdpChart.data.labels = ["Start"];
        gdpChart.data.datasets[0].data = [state.gdp];

        // Reset Exchange Rate chart
        exchangeRateChart.data.labels = ["Start"];
        exchangeRateChart.data.datasets[0].data = [state.exchangeRate];

        // Reset Current Account chart
        currentAccountChart.data.labels = ["Start"];
        currentAccountChart.data.datasets[0].data = [state.currentAccount];

        // Reset AA and DD curves
        aaddChart.data.datasets[0].data = generateAACurve();
        aaddChart.data.datasets[1].data = generateDDCurve();

        // Reset current position
        aaddChart.data.datasets[2].data = [
          { x: state.gdp, y: state.exchangeRate },
        ];

        // Update charts
        gdpChart.update();
        exchangeRateChart.update();
        currentAccountChart.update();
        aaddChart.update();
      }

      // Initialize the application
      document.addEventListener("DOMContentLoaded", () => {
        initializeCharts();
        addHistoryEntry("Simulation started with default parameters");
      });
    </script>
  </body>
</html>
